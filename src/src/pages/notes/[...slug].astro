---
import { CollectionEntry, getCollection } from 'astro:content'
import IndexLayout from '../../layouts/IndexLayout.astro'
import FormattedDate from '../../components/partials/FormattedDate.astro'
import Giscus from '../../components/embeds/Giscus.astro'

export async function getStaticPaths() {
  const notes = await getCollection('note')
  return notes.map((note) => ({
    params: { slug: note.slug },
    props: note,
  }))
}

type Props = CollectionEntry<'note'>

const note = Astro.props
const { Content } = await note.render()
const { title, pubDateTime, tags, externalUrl, externalPlatform } = note.data
---

<IndexLayout title={title ?? 'Note'} description={note.data.description ?? 'A short note from Sealjay.'}>
  <div class="mx-auto max-w-3xl">
    <a
      href="/notes"
      class="mb-6 inline-flex items-center gap-1 text-sm text-zinc-500 transition hover:text-accent-600 dark:text-zinc-400 dark:hover:text-accent-400"
    >
      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
        <path
          fill-rule="evenodd"
          d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z"
          clip-rule="evenodd"
        />
      </svg>
      Back to notes
    </a>

    <article>
      <header class="mb-8">
        <div class="text-sm text-zinc-500 dark:text-zinc-400">
          <FormattedDate date={pubDateTime} />
        </div>

        {title && <h1 class="mt-2 text-3xl font-bold tracking-tight text-zinc-800 dark:text-zinc-100">{title}</h1>}

        {
          tags && tags.length > 0 && (
            <div class="mt-4 flex flex-wrap gap-2">
              {tags.map((tag) => (
                <span class="inline-block rounded-full bg-accent-100 px-3 py-0.5 text-sm font-medium text-accent-700 dark:bg-accent-900/30 dark:text-accent-300">
                  #{tag}
                </span>
              ))}
            </div>
          )
        }
      </header>

      {
        externalUrl && (
          <div class="mb-8 rounded-lg border border-zinc-200 bg-zinc-50 p-4 dark:border-zinc-700 dark:bg-zinc-800/50">
            <p class="flex items-center gap-2 text-sm text-zinc-600 dark:text-zinc-300">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 shrink-0" viewBox="0 0 20 20" fill="currentColor">
                <path d="M11 3a1 1 0 100 2h2.586l-6.293 6.293a1 1 0 101.414 1.414L15 6.414V9a1 1 0 102 0V4a1 1 0 00-1-1h-5z" />
                <path d="M5 5a2 2 0 00-2 2v8a2 2 0 002 2h8a2 2 0 002-2v-3a1 1 0 10-2 0v3H5V7h3a1 1 0 000-2H5z" />
              </svg>
              <span>
                Originally shared on{' '}
                <a
                  href={externalUrl}
                  target="_blank"
                  rel="noopener noreferrer"
                  class="font-medium text-accent-600 underline hover:text-accent-700 dark:text-accent-400 dark:hover:text-accent-300"
                >
                  {externalPlatform ?? 'an external site'}
                </a>
              </span>
            </p>
          </div>
        )
      }

      <div class="prose prose-lg dark:prose-invert prose-headings:font-semibold prose-a:text-accent-600 dark:prose-a:text-accent-400">
        <Content />
      </div>
    </article>

    <div class="mt-16 mb-8">
      <div class="h-px bg-gradient-to-r from-transparent via-zinc-300 dark:via-zinc-700 to-transparent mb-8"></div>
      <Giscus />
    </div>
  </div>
</IndexLayout>
