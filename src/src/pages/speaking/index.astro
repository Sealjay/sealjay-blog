---
import Layout from '../../layouts/IndexLayout.astro'
import Badge from '../../components/partials/Badge.astro'
import { getCollection } from 'astro:content'
import FormattedDate from '../../components/partials/FormattedDate.astro'
import Card from '../../components/partials/Card.astro'

const speakingSlots = await getCollection('speaking')
const sortedSpeakingSlots = [...speakingSlots].sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
const lastConferenceSlot = speakingSlots.reduce((prev, current) => (prev.data.date > current.data.date ? prev : current))

const eventTypes = [...new Set(speakingSlots.map((s) => s.data.eventType))].sort()
---

<Layout
  title="I speak at events, share my insights and learn from others"
  description="Conference talks, media mentions, and speaking engagements on open source, green software, and Microsoft AI"
  pubDateTime={new Date('1 March 2023')}
  updatedDate={lastConferenceSlot.data.date}
>
  <div class="mx-auto max-w-5xl">
    <!-- Page Header -->
    <div class="mb-10 md:mb-16">
      <h1 class="text-3xl sm:text-4xl font-bold tracking-tight text-zinc-800 dark:text-zinc-100 mb-4">
        <span class="text-gradient">Speaking</span>
      </h1>
      <p class="text-lg text-zinc-600 dark:text-zinc-400 max-w-3xl">
        I'm passionate about open-source, green software, and Microsoft AI: you can find here previous conference talks, media mentions, and other speaking engagements.
      </p>
    </div>

    <!-- Speaker Kit CTA -->
    <div class="mb-10 rounded-xl bg-accent-50 dark:bg-accent-900/20 border border-accent-200 dark:border-accent-800/40 p-6 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
      <div>
        <h3 class="font-semibold text-zinc-900 dark:text-zinc-100 mb-1">Want me to speak at your event?</h3>
        <p class="text-sm text-zinc-600 dark:text-zinc-400">View my speaker kit for topics, formats, and booking info.</p>
      </div>
      <a
        href="/speaking/kit"
        class="inline-flex items-center gap-2 rounded-full bg-accent-600 dark:bg-accent-500 px-5 py-2.5 text-sm font-semibold text-white shadow-sm hover:bg-accent-700 dark:hover:bg-accent-600 transition-colors whitespace-nowrap"
      >
        Speaker Kit
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3" />
        </svg>
      </a>
    </div>

    <!-- Filter Pills -->
    <div class="mb-8 flex flex-wrap gap-2" id="speaking-filters">
      <button
        data-filter="all"
        class="speaking-filter-btn active inline-flex items-center rounded-full px-4 py-1.5 text-sm font-medium transition-colors bg-zinc-800 text-white dark:bg-zinc-100 dark:text-zinc-900"
      >
        All
      </button>
      {eventTypes.map((type) => (
        <button
          data-filter={type}
          class="speaking-filter-btn inline-flex items-center rounded-full px-4 py-1.5 text-sm font-medium transition-colors bg-zinc-100 text-zinc-700 hover:bg-zinc-200 dark:bg-zinc-800 dark:text-zinc-300 dark:hover:bg-zinc-700"
        >
          {type}
        </button>
      ))}
    </div>

    <div class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3" id="speaking-grid">
      {sortedSpeakingSlots.map((slot) => (
        <div class="speaking-card" data-event-type={slot.data.eventType}>
          <Card
            url={slot.data.url}
            cta="View event"
            hasHeaderBg={true}
            compactHeader={true}
          >
            <div class="flex items-center gap-2 text-zinc-500 dark:text-zinc-400" slot="title">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
              </svg>
              <FormattedDate date={slot.data.date} />
            </div>

            <div class="mb-4">
              <h3 class="text-lg font-semibold text-zinc-900 dark:text-zinc-100 group-hover:text-accent-600 dark:group-hover:text-accent-400 transition-colors mb-2">
                {slot.data.title}
              </h3>
              <p class="text-zinc-600 dark:text-zinc-400">
                {slot.data.event}
              </p>
            </div>

            <div class="flex flex-wrap gap-2">
              <Badge text={slot.data.eventType} />

              {slot.data.blogPostSlug && (
                <a
                  href={`/blog/${slot.data.blogPostSlug}`}
                  class="inline-flex items-center rounded-full bg-zinc-100 dark:bg-zinc-800 px-2.5 py-0.5 text-xs font-medium text-zinc-700 dark:text-zinc-300 hover:bg-zinc-200 dark:hover:bg-zinc-700 transition-colors"
                >
                  View related blog post
                </a>
              )}
            </div>
          </Card>
        </div>
      ))}
    </div>
  </div>
</Layout>

<script>
  function initSpeakingFilters() {
    const buttons = document.querySelectorAll<HTMLButtonElement>('.speaking-filter-btn')
    const cards = document.querySelectorAll<HTMLElement>('.speaking-card')

    const activeClass = 'bg-zinc-800 text-white dark:bg-zinc-100 dark:text-zinc-900'
    const inactiveClass =
      'bg-zinc-100 text-zinc-700 hover:bg-zinc-200 dark:bg-zinc-800 dark:text-zinc-300 dark:hover:bg-zinc-700'

    function setFilter(filter: string) {
      for (const btn of buttons) {
        const isActive = btn.dataset.filter === filter
        for (const cls of [...activeClass.split(' '), ...inactiveClass.split(' ')]) {
          btn.classList.remove(cls)
        }
        for (const cls of (isActive ? activeClass : inactiveClass).split(' ')) {
          btn.classList.add(cls)
        }
      }

      for (const card of cards) {
        if (filter === 'all' || card.dataset.eventType === filter) {
          card.classList.remove('hidden')
        } else {
          card.classList.add('hidden')
        }
      }
    }

    for (const btn of buttons) {
      btn.addEventListener('click', () => {
        const filter = btn.dataset.filter ?? 'all'
        setFilter(filter)
        if (typeof window.plausible !== 'undefined') {
          window.plausible('Speaking Filter', { props: { eventType: filter } })
        }
      })
    }
  }

  document.addEventListener('astro:page-load', initSpeakingFilters)
  initSpeakingFilters()
</script>
