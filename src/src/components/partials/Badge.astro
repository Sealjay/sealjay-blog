---
interface Props {
  /** Badge text (new API) */
  label?: string
  /** Badge text (legacy API, alias for label) */
  text?: string
  /** Visual variant */
  variant?: 'default' | 'warm' | 'success' | 'subtle'
  /** Optional link URL */
  url?: string
  /** Legacy prop: maps to "subtle" variant */
  isFormerRole?: boolean
  /** Additional CSS classes */
  class?: string
  /** Inline style for CSS custom properties (e.g. tag category colours) */
  style?: string
}

const {
  label,
  text,
  variant: variantProp,
  url,
  isFormerRole = false,
  class: className,
  style,
} = Astro.props

const displayText = label ?? text ?? ''

// Resolve variant: explicit variant wins, then isFormerRole legacy mapping
const variant = variantProp ?? (isFormerRole ? 'subtle' : 'default')

const Tag = url ? 'a' : 'span'
const linkProps = url ? { href: url } : {}
---

<Tag
  {...linkProps}
  class:list={[
    'badge',
    `badge--${variant}`,
    url && 'badge--link',
    className,
  ]}
  style={style}
>
  {isFormerRole && !variantProp && <span class="badge__prefix">formerly</span>}
  {displayText}
</Tag>

<style>
  .badge {
    display: inline-flex;
    align-items: center;
    border-radius: var(--radius-full);
    padding: 3px 10px;
    font-family: var(--font-heading);
    font-size: 0.6875rem;
    line-height: 1;
    font-weight: 500;
    text-decoration: none;
    white-space: nowrap;
    transition: background var(--duration-fast) var(--ease-out),
                border-color var(--duration-fast) var(--ease-out);
  }

  .badge--default {
    background: var(--tag-bg, var(--color-primary-muted));
    border: 1px solid color-mix(in srgb, var(--tag-color, var(--color-primary)) 25%, transparent);
    color: var(--tag-color, var(--color-primary));
  }

  .badge--warm {
    background: var(--color-warm-muted);
    border: 1px solid color-mix(in srgb, var(--color-warm) 30%, transparent);
    color: var(--color-warm);
  }

  .badge--success {
    background: color-mix(in srgb, var(--color-success) 8%, transparent);
    border: 1px solid color-mix(in srgb, var(--color-success) 30%, transparent);
    color: var(--color-success);
  }

  .badge--subtle {
    background: transparent;
    border: 1px solid var(--color-border);
    color: var(--color-text-muted);
  }

  .badge--link:hover {
    border-color: var(--color-border-strong);
  }

  .badge--link:focus-visible {
    outline: 2px solid var(--color-primary);
    outline-offset: 2px;
  }

  .badge__prefix {
    margin-right: 0.25rem;
    opacity: 0.8;
  }
</style>
