---
interface Props {
  /** Makes the entire card a clickable link */
  href?: string
  /** URL for the CTA link (legacy prop, use href for clickable cards) */
  url?: string
  /** CTA text shown in footer (legacy prop) */
  cta?: string
  /** Enable hover lift effect */
  hover?: boolean
  /** Show header background (legacy prop) */
  hasHeaderBg?: boolean
  /** Use compact header (legacy prop) */
  compactHeader?: boolean
  /** Content gap class (legacy prop) */
  contentGap?: string
  /** Additional CSS classes */
  class?: string
}

const {
  href,
  url,
  cta,
  hover = true,
  hasHeaderBg = false,
  compactHeader = false,
  contentGap = 'gap-3',
  class: className,
} = Astro.props

const hasLegacySlots = Astro.slots.has('title') || Astro.slots.has('bottom-left')
const isClickable = !!href
const Tag = isClickable ? 'a' : 'div'
const linkProps = isClickable ? { href } : {}
---

<Tag
  {...linkProps}
  class:list={[
    'card-component group relative flex h-full flex-col overflow-hidden',
    isClickable && 'cursor-pointer no-underline',
    hover && 'card-hover-effect',
    className,
  ]}
>
  {hasLegacySlots ? (
    <>
      <div
        class:list={[
          'card-header',
          compactHeader ? 'card-header--compact' : '',
          hasHeaderBg ? 'card-header--bg' : '',
        ]}
      >
        <slot name="title" />
      </div>
      <div class={`card-body ${contentGap}`}>
        <slot />
      </div>
      <div class="card-footer">
        <div class="card-footer__left">
          <slot name="bottom-left" />
        </div>
        {(cta && url) && (
          <div>
            <a
              href={url}
              target="_blank"
              rel="noopener noreferrer"
              class="card-cta"
            >
              <span>{cta}</span>
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="card-cta__icon"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
                aria-hidden="true"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M14 5l7 7m0 0l-7 7m7-7H3"
                />
              </svg>
              <span class="sr-only">(opens in new tab)</span>
            </a>
          </div>
        )}
      </div>
    </>
  ) : (
    <div class="card-body-simple">
      <slot />
    </div>
  )}
</Tag>

<style>
  .card-component {
    background: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    box-shadow: var(--color-card-glow);
    transition: border-color var(--duration-normal) var(--ease-out),
                transform var(--duration-normal) var(--ease-out),
                box-shadow var(--duration-normal) var(--ease-out);
  }

  .card-hover-effect:hover {
    border-color: var(--color-border-strong);
    transform: translateY(-2px);
  }

  .card-header {
    display: flex;
    align-items: center;
    min-height: 48px;
    padding: 0.625rem 1rem;
    font-size: 0.875rem;
    font-family: var(--font-heading);
    font-weight: 500;
    color: var(--color-text);
  }

  .card-header--compact {
    min-height: 40px;
    padding: 0.5rem 1rem;
  }

  .card-header--bg {
    background: var(--color-surface-hover);
  }

  .card-body {
    display: flex;
    flex-grow: 1;
    flex-direction: column;
    padding: 0.75rem 1rem;
  }

  .card-body-simple {
    display: flex;
    flex-grow: 1;
    flex-direction: column;
    padding: 1.25rem;
  }

  .card-footer {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-top: auto;
    padding: 0.75rem 1rem;
    border-top: 1px solid var(--color-border);
  }

  .card-footer__left {
    font-size: 0.75rem;
    color: var(--color-text-muted);
  }

  .card-cta {
    display: inline-flex;
    align-items: center;
    padding: 0.375rem 0.625rem;
    margin-right: -0.25rem;
    border-radius: var(--radius-sm);
    font-size: 0.75rem;
    font-family: var(--font-heading);
    font-weight: 500;
    color: var(--color-primary);
    text-decoration: none;
    transition: color var(--duration-fast) var(--ease-out),
                background var(--duration-fast) var(--ease-out);
  }

  .card-cta:hover {
    background: var(--color-primary-muted);
  }

  .card-cta:focus-visible {
    outline: 2px solid var(--color-primary);
    outline-offset: 2px;
  }

  .card-cta__icon {
    width: 0.875rem;
    height: 0.875rem;
    margin-left: 0.375rem;
    transition: transform var(--duration-normal) var(--ease-out);
  }

  .card-component:hover .card-cta__icon {
    transform: translateX(4px);
  }
</style>
