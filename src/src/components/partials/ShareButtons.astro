---
interface Props {
  url: string
  title: string
}

const { url, title } = Astro.props
const encodedUrl = encodeURIComponent(url)
const encodedTitle = encodeURIComponent(title)
const linkedInUrl = `https://www.linkedin.com/sharing/share-offsite/?url=${encodedUrl}`
const blueskyUrl = `https://bsky.app/intent/compose?text=${encodedTitle}%20${encodedUrl}`
---

<div class="share-buttons" aria-label="Share this article">
  <span class="share-label">Share</span>
  <button class="share-btn" data-copy-url={url} aria-label="Copy link to clipboard">
    <svg xmlns="http://www.w3.org/2000/svg" class="share-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" />
    </svg>
    <span class="share-btn-text" data-default="Copy link" data-copied="Copied!">Copy link</span>
  </button>
  <a href={linkedInUrl} target="_blank" rel="noopener noreferrer" class="share-btn" aria-label="Share on LinkedIn">
    <svg xmlns="http://www.w3.org/2000/svg" class="share-icon" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
      <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 01-2.063-2.065 2.064 2.064 0 112.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z" />
    </svg>
    <span class="share-btn-text">LinkedIn</span>
    <span class="sr-only">(opens in new tab)</span>
  </a>
  <a href={blueskyUrl} target="_blank" rel="noopener noreferrer" class="share-btn" aria-label="Share on Bluesky">
    <svg xmlns="http://www.w3.org/2000/svg" class="share-icon" viewBox="0 0 576 512" fill="currentColor" aria-hidden="true">
      <path d="M407.8 294.7c-3.3-.4-6.7-.8-10-1.3 3.4.4 6.7.9 10 1.3zM288 227.1C261.9 176.4 190.9 81.9 124.9 35.3 61.6-9.4 37.5-1.7 21.6 5.5 3.3 13.8 0 41.9 0 58.4S9.1 194 15 213.9c19.5 65.7 89.1 87.9 153.2 80.7 3.3-.5 6.6-.9 10-1.4-3.3.5-6.6 1-10 1.4C60.8 304.7 19.7 396.1 56.7 467.4c34.5 66.4 139.6 143.4 231.3 37.1l.1-.1.1.1c91.7 106.3 196.8 29.3 231.3-37.1 36.9-71.3-4.1-174.8-111.5-186.7 3.4-.4 6.7-.9 10-1.4-3.4.5-6.7 1-10 1.4 64.1 7.1 133.7-15.1 153.2-80.7C566.9 194 576 75 576 58.4s-3.3-44.7-21.6-52.9c-15.8-7.1-40-14.9-103.2 29.8C385.1 81.9 314.1 176.4 288 227.1z" />
    </svg>
    <span class="share-btn-text">Bluesky</span>
    <span class="sr-only">(opens in new tab)</span>
  </a>
  <button type="button" class="share-btn share-btn--mastodon" aria-label="Share on Mastodon" data-mastodon-url={`${title}\n${url}`}>
    <svg xmlns="http://www.w3.org/2000/svg" class="share-icon" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
      <path d="M23.268 5.313c-.35-2.578-2.617-4.61-5.304-5.004C17.51.242 15.792 0 11.813 0h-.03c-3.98 0-4.835.242-5.288.309C3.882.692 1.496 2.518.917 5.127.64 6.412.61 7.837.661 9.143c.074 1.874.088 3.745.26 5.611.118 1.24.325 2.47.62 3.68.55 2.237 2.777 4.098 4.96 4.857 2.336.792 4.849.923 7.256.38.265-.061.527-.132.786-.213.585-.184 1.27-.39 1.774-.753a.057.057 0 00.023-.043v-1.809a.052.052 0 00-.02-.041.053.053 0 00-.046-.01 20.282 20.282 0 01-4.709.545c-2.73 0-3.463-1.284-3.674-1.818a5.593 5.593 0 01-.319-1.433.053.053 0 01.066-.054 19.357 19.357 0 004.636.528c.484 0 .968-.008 1.45-.031 2.024-.098 4.17-.29 6.115-.84l.144-.04c2.407-.654 4.503-2.68 4.72-7.094.009-.157.039-1.637.039-1.8 0-.55.18-3.897-.025-5.456z" />
    </svg>
    <span class="share-btn-text">Mastodon</span>
  </button>
</div>

<style>
  .share-buttons {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    flex-wrap: wrap;
    margin-bottom: 1rem;
  }

  .share-label {
    font-family: var(--font-heading);
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--color-text-subtle);
    margin-right: 0.25rem;
  }

  .share-btn {
    display: inline-flex;
    align-items: center;
    gap: 0.375rem;
    padding: 0.375rem 0.75rem;
    border-radius: var(--radius-full);
    border: 1px solid var(--color-border);
    background: var(--color-surface);
    color: var(--color-text-muted);
    font-family: var(--font-heading);
    font-size: 0.75rem;
    font-weight: 500;
    text-decoration: none;
    cursor: pointer;
    transition: background var(--duration-fast) var(--ease-out),
                border-color var(--duration-fast) var(--ease-out),
                color var(--duration-fast) var(--ease-out);
  }

  .share-btn:hover {
    background: var(--color-primary-muted);
    border-color: var(--color-border-strong);
    color: var(--color-primary);
  }

  .share-btn:focus-visible {
    outline: 2px solid var(--color-primary);
    outline-offset: 2px;
  }

  .share-icon {
    width: 0.875rem;
    height: 0.875rem;
    flex-shrink: 0;
  }
</style>

<script>
  function initShareButtons() {
    // Copy link button
    const copyBtns = document.querySelectorAll<HTMLButtonElement>('[data-copy-url]')
    for (const btn of copyBtns) {
      btn.addEventListener('click', async () => {
        const url = btn.dataset.copyUrl
        if (!url) return
        try {
          await navigator.clipboard.writeText(url)
          const textEl = btn.querySelector('.share-btn-text')
          if (textEl) {
            textEl.textContent = textEl.getAttribute('data-copied') ?? 'Copied!'
            setTimeout(() => {
              textEl.textContent = textEl.getAttribute('data-default') ?? 'Copy link'
            }, 2000)
          }
        } catch {
          const input = document.createElement('input')
          input.value = url
          document.body.appendChild(input)
          input.select()
          document.execCommand('copy')
          document.body.removeChild(input)
        }
      })
    }

    // Mastodon share â€” prompt for instance
    const mastodonBtns = document.querySelectorAll<HTMLButtonElement>('[data-mastodon-url]')
    for (const btn of mastodonBtns) {
      btn.addEventListener('click', () => {
        const text = btn.dataset.mastodonUrl ?? ''
        const instance = window.prompt('Enter your Mastodon instance (e.g. fosstodon.org):')
        if (instance) {
          const cleanInstance = instance.replace(/^https?:\/\//, '').replace(/\/$/, '')
          window.open(`https://${cleanInstance}/share?text=${encodeURIComponent(text)}`, '_blank', 'noopener')
        }
      })
    }
  }

  initShareButtons()
  document.addEventListener('astro:page-load', initShareButtons)
</script>
