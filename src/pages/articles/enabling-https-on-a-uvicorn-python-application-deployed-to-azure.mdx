import { ArticleLayout } from '@/components/ArticleLayout'

export const meta = {
  author: 'Chris Lloyd-Jones',
  date: '2021-02-09T10:10:00.000Z',
  tags: ['Snippets'],
  title: 'Enabling https on a Uvicorn Python Application deployed to Azure',
  slug: 'enabling-https-on-a-uvicorn-python-application-deployed-to-azure',
}

export default (props) => <ArticleLayout meta={meta} {...props} />

<p>
  Like many services,{' '}
  <a href="https://docs.microsoft.com/en-us/azure/app-service/configure-language-python#detect-https-session">
    Azure terminates SSL at the network load balancer
  </a>
  . In plain English, your application needs to check the headers provided to
  it, to figure out if your user has connected via https.
</p>
<p>
  If you're using Uvicorn or another ASGI provider, you'll need to include
  middleware, to check the <code>X-Forwarded-Proto</code> and{' '}
  <code>X-Forwarded-For</code> headers.
</p>
<p>
  Thankfully, Uvicorn already provides a package you can import for this:{' '}
  <code>uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware</code>.
</p>
<p>
  Import the full{' '}
  <code>uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware</code> package,
  specifying a specific trusted host to check for headers, or use a wildcard for
  all hosts.
</p>
<p>
  For example, in a{' '}
  <a href="https://www.starlette.io/middleware/">Starlette deployment</a> you
  could include the library like so:
</p>
<pre>
  <code class="language-python">
    import uvicorn # ... Middleware(
    uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware,
    trusted_hosts=&quot;*&quot; )# Add the uvicorn middleware to the Starlette
    middleware classes # ...
  </code>
</pre>
